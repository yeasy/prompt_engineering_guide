## 13.2 Anthropic Claude 提示技巧

> **说明：** 本节所涉及的模型特性及最佳实践基于 2026 年初的版本（涵盖 Claude 3.5 家族）编写。在实际应用中请参考 Anthropic 最新的官方文档。

Anthropic 的 Claude 系列以卓越的安全性、超长上下文窗口和独特的提示词技术著称。本节深入介绍 Claude 的核心特性和针对性的提示词优化策略。

### 13.2.1 Claude 模型系列

Claude 目前提供多个模型层级，满足不同场景需求：

| 模型 | 上下文 | 核心优势 | 适用场景 |
|------|-------|---------|----------|
| Claude Opus 4.5 | 200K | 最强能力、深度分析、增强安全 | 复杂研究、高级推理 |
| Claude Sonnet 4.5 | 200K | 领先编码能力、VS Code 集成 | 企业应用、软件开发 |
| Claude Sonnet 4 | 200K | 平衡性能与成本 | 通用任务 |
| Claude Haiku 4 | 200K | 快速响应、低成本 | 简单任务、高并发 |

> **说明（平台迁移）**：自 2026 年 1 月 12 日起，`console.anthropic.com` 已重定向至 `platform.claude.com`。旧版 Claude Opus 3 和 Haiku 3.5 已弃用，建议升级至最新版本。

### 13.2.2 XML 标签：Claude 的提示词利器

Claude 对 XML 标签有出色的识别和遵从能力，这是区别于其他模型的标志性特征。

#### 基础结构

```xml
<context>
你正在帮助一家电商公司分析用户反馈。该公司主营电子产品，
目标客户群体为 25-45 岁的城市白领。
</context>

<documents>
<doc id="1">用户A评价：产品质量很好，但物流太慢...</doc>
<doc id="2">用户B评价：性价比超高，强烈推荐...</doc>
</documents>

<task>
请分析上述用户反馈，识别主要的正面和负面主题，
并提供可操作的改进建议。
</task>

<output_format>
请按以下结构输出：
1. 正面主题（列表）
2. 负面主题（列表）
3. 改进建议（按优先级排序）
</output_format>
```

#### 常用 XML 标签

```mermaid
flowchart TB
    subgraph Tags["常用 XML 标签"]
        context["&lt;context&gt; 背景信息"]
        documents["&lt;documents&gt; 待处理文档"]
        task["&lt;task&gt; 任务描述"]
        format["&lt;output_format&gt; 格式要求"]
        examples["&lt;examples&gt; 示例"]
        rules["&lt;rules&gt; 规则限制"]
    end
    
    context --> task
    documents --> task
    task --> format
    examples --> format
    rules --> format
    
    style context fill:#e3f2fd
    style task fill:#fff3e0
    style format fill:#e8f5e9
```

*图 13.2-1：Claude XML 标签结构*

### 13.2.3 预填充技术

预填充是 Claude 独有的强大功能，通过预设回复的开头部分，精确控制输出格式。

#### 基本用法

```python
from anthropic import Anthropic

client = Anthropic()

response = client.messages.create(
    model="claude-sonnet-4-20250514",
    max_tokens=1024,
    messages=[
        {"role": "user", "content": "分析这段文本的情感倾向：'产品很棒，但客服态度一般'"},
        {"role": "assistant", "content": '{"sentiment":'}  # 预填充
    ]
)
# Claude 将从预填充位置继续：{"sentiment": "mixed", "details": ...}

for block in response.content:
    if block.type == "text":
        print(block.text)
```

#### 进阶应用：强制 JSON 输出

```python
prompt = "请输出一个 JSON，包含字段 sentiment 与 confidence。"

messages = [
    {"role": "user", "content": prompt},
    {"role": "assistant", "content": "```json\n{"}
]
# Claude 将输出完整的 JSON，并以 ``` 结尾

print(messages)
```

#### 预填充的最佳实践

| 场景 | 预填充内容 | 效果 |
|------|-----------|------|
| JSON 输出 | `{"` 或 `[{` | 确保 JSON 格式 |
| 编号列表 | `1. ` | 强制列表格式 |
| 代码输出 | \`\`\`python\n | 确保代码块格式 |
| 特定开头 | `根据分析，` | 控制回答风格 |

### 13.2.4 扩展思考

Claude 3.5 及 Claude 4 支持扩展思考功能，允许模型在回答前进行深入的内部推理。

#### 启用扩展思考

```python
from anthropic import Anthropic

client = Anthropic()
complex_problem = "请证明：1+2+...+n = n(n+1)/2。"

response = client.messages.create(
    model="claude-sonnet-4-20250514",
    max_tokens=16000,
    thinking={
        "type": "enabled",
        "budget_tokens": 10000  # 分配给思考的 token 预算
    },
    messages=[{"role": "user", "content": complex_problem}]
)

# 访问思考过程
for block in response.content:
    if block.type == "thinking":
        print("思考过程:", block.thinking)
    elif block.type == "text":
        print("最终回答:", block.text)
```

#### 扩展思考的适用场景

- **数学证明**：需要多步骤逻辑推导
- **代码调试**：需要追踪复杂执行流程
- **策略分析**：需要权衡多种因素
- **学术研究**：需要深入分析论证

### 13.2.5 长上下文处理策略

Claude 的 200K 上下文窗口可以处理整本书籍，但需要注意信息组织策略。

#### 关键信息位置原则

```
⚠️ "中间迷失"（Lost in the Middle）现象：
模型对上下文开头和结尾的信息关注度更高，
中间部分的信息可能被忽略。

✅ 解决方案：
1. 将最重要的信息放在开头或结尾
2. 使用明确的标签分隔不同部分
3. 在问题中引用关键段落编号
```

#### 长文档处理模板

```xml
<document>
以下是一份 150 页的技术报告，请仔细阅读后回答问题。
{long_document_content}
</document>

<question>
根据上述报告第三章的数据，分析2024年的市场趋势。
注意：请确保答案基于报告内容，如有不确定请明确指出。
</question>
```

### 13.2.6 安全与对齐特性

Claude 在安全对齐方面有独特优势，适合构建高可靠性应用。

#### 利用 Claude 的诚实性

```xml
<instructions>
请分析以下商业提案的可行性。

重要规则：
- 如果信息不足以做出判断，请明确说明需要哪些额外信息
- 如果发现潜在风险，请详细列出
- 不要为了显得有帮助而忽略问题
</instructions>
```

#### 防止有害输出

Claude 天然具有较强的安全边界，但仍可通过系统提示词强化：

```xml
<system_rules>
你是一个专业的法律顾问助手。

禁止事项：
- 不得提供具体的法律建议，只能提供一般性信息
- 遇到敏感话题时，建议用户咨询专业律师
- 不得帮助规避法律
</system_rules>
```

### 13.2.7 实战示例：复杂文档分析

```xml
<role>
你是一位资深的商业分析师，擅长从财务报告中提取关键洞察。
</role>

<context>
客户是一家寻求投资的初创公司，需要评估目标公司的财务健康状况。
</context>

<documents>
<annual_report>
{complete_annual_report_content}
</annual_report>
</documents>

<task>
请完成以下分析任务：
1. 提取关键财务指标（收入、利润、现金流）
2. 识别年报中的风险信号
3. 评估公司的长期增长潜力
4. 给出投资建议（推荐/谨慎/不推荐）
</task>

<output_format>
## 财务指标摘要
| 指标 | 数值 | 同比变化 |
...

## 风险信号
1. ...

## 增长潜力评估
...

## 投资建议
建议：[推荐/谨慎/不推荐]
理由：...
</output_format>
```

### 想一想

1. Claude 偏好 XML 标签来组织提示词结构——这和 GPT 偏好的 Markdown 格式相比，在什么场景下优势更明显？
2. Claude 的"extended thinking"功能相当于内置了思维链——这是否意味着你不再需要手动添加"一步步思考"之类的指令？
